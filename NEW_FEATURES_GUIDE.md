# 新功能使用指南

## 概述

本次更新为系统添加了以下重要功能：

1. **DeepSeek AI 智能分析** - 自动分析训练视频并生成专业建议
2. **学员报告管理** - 选择学员并发送训练报告到家长端

## 功能详情

### 1. DeepSeek AI 智能分析

#### 功能说明

系统集成了 DeepSeek 大模型 API，可以对训练视频的指标数据进行智能分析，生成专业的训练建议报告。

#### 支持的训练类型

- **投篮训练（Shooting）**
  - 分析指标：肘部角度、手腕角度、出手高度、身体垂直度等
  - AI 建议：投篮姿势优化、发力技巧、身体协调性改进
  
- **运球训练（Dribbling）**
  - 分析指标：运球频率、重心控制、手腕灵活性、膝盖角度等
  - AI 建议：运球节奏控制、重心稳定性、手部技巧提升
  
- **防守训练（Defense）**
  - 分析指标：重心稳定性、手臂张开程度、膝盖弯曲、身体平衡度等
  - AI 建议：防守姿态优化、移动技巧、持久性训练

#### 分析报告内容

AI 分析会生成以下内容：

1. **整体评价（Summary）** - 2-3句话总结训练表现
2. **改进建议（Suggestions）** - 3-5条具体可操作的改进建议
3. **需要改进的方面（Improvement Areas）** - 关键改进点列表
4. **优势方面（Strengths）** - 表现较好的方面
5. **综合评分（Overall Score）** - 0-100分的量化评分

#### 使用步骤

1. 上传训练视频
2. 等待视频分析完成（系统会自动提取骨架和计算指标）
3. AI 自动分析指标数据（显示"AI正在分析视频..."）
4. 查看 AI 智能分析结果卡片
5. 点击"查看详细报告"按钮查看完整分析

#### 降级方案

当 DeepSeek API 不可用时（未设置 API Key、网络问题、API 限额等），系统会：

- 自动使用预设的专业训练建议
- 显示提示信息告知用户
- 保证系统正常运行，不影响核心功能

### 2. 学员报告管理系统

#### 功能说明

教练可以在训练分析完成后，选择学员并将训练报告发送到该学员的家长账户。

#### 使用步骤

##### 步骤 1：查看 AI 分析结果

在视频分析完成后，AI 分析结果会自动显示在页面上。

##### 步骤 2：选择学员

在"发送训练报告到家长端"卡片中：

1. 点击下拉菜单
2. 从列表中选择学员
3. 当前可选学员：
   - 李明（初一（3）班）
   - 王芳（初二（1）班）
   - 张伟（初一（2）班）
   - 刘洋（初三（4）班）
   - 陈雪（初二（3）班）

##### 步骤 3：发送报告

1. 选择学员后，点击"发送到家长端"按钮
2. 系统会自动：
   - 生成训练报告
   - 保存报告到数据库
   - 发送报告到该学员的家长账户
3. 显示成功提示："训练报告已成功发送到XXX的家长"

#### 报告内容

发送的训练报告包含：

- 学员信息（姓名、ID）
- 训练类型（投篮/运球/防守）
- AI 分析结果（评分、建议、优势、改进点）
- 完整的训练指标数据
- 时间戳

#### 家长端查看

家长可以在家长端查看：

- 收到的所有训练报告
- 训练历史记录
- AI 分析建议
- 孩子的训练进度

### 3. 页面更新

#### 投篮训练页面（Shooting.tsx）

更新内容：

- ✅ 添加 AI 智能分析显示
- ✅ 添加学员选择下拉框
- ✅ 添加发送报告功能
- ✅ 添加成功/失败提示

#### 运球训练页面（Dribbling.tsx）

更新内容：

- ✅ 添加 AI 智能分析显示
- ✅ 添加学员选择下拉框
- ✅ 添加发送报告功能
- ✅ 添加成功/失败提示

#### 防守训练页面（Defense.tsx）

更新内容：

- ✅ 添加 AI 智能分析显示
- ✅ 添加学员选择下拉框
- ✅ 添加发送报告功能
- ✅ 添加成功/失败提示

## API 接口

### 新增后端接口

#### 1. AI 分析接口

```
POST /api/ai-analysis
Content-Type: application/json

Request Body:
{
  "trainingType": "shooting|dribbling|defense",
  "metrics": [...],  // 指标数据数组
  "videoSummary": "视频描述"
}

Response:
{
  "summary": "整体评价文本",
  "suggestions": ["建议1", "建议2", ...],
  "improvementAreas": ["改进点1", "改进点2", ...],
  "strengths": ["优势1", "优势2", ...],
  "overallScore": 75
}
```

#### 2. 获取学员列表

```
GET /api/students

Response:
[
  {
    "id": "student-001",
    "name": "李明",
    "parentId": "parent-001",
    "age": 14,
    "class": "初一（3）班"
  },
  ...
]
```

#### 3. 生成训练报告

```
POST /api/training-reports
Content-Type: application/json

Request Body:
{
  "studentId": "student-001",
  "studentName": "李明",
  "trainingType": "shooting",
  "analysisResult": {...},  // AI分析结果
  "metrics": [...]  // 指标数据
}

Response:
{
  "id": "report-uuid",
  "studentId": "student-001",
  "studentName": "李明",
  "trainingType": "shooting",
  "analysisResult": {...},
  "metrics": [...],
  "timestamp": "2025-10-16T12:00:00",
  "sentToParent": false
}
```

#### 4. 发送报告到家长端

```
POST /api/send-report-to-parent
Content-Type: application/json

Request Body:
{
  "reportId": "report-uuid",
  "parentId": "parent-001"
}

Response:
{
  "success": true,
  "message": "训练报告已成功发送到家长端"
}
```

#### 5. 获取学员报告历史

```
GET /api/students/{studentId}/reports

Response:
[
  {
    "id": "report-uuid",
    "trainingType": "shooting",
    "analysisResult": {...},
    "timestamp": "2025-10-16T12:00:00",
    "sentToParent": true
  },
  ...
]
```

## 配置说明

### DeepSeek API Key 配置

请参考 [DEEPSEEK_API_SETUP.md](./DEEPSEEK_API_SETUP.md) 文档了解如何：

1. 获取 DeepSeek API Key
2. 设置环境变量
3. 启动服务
4. 故障排查

### 数据库配置（可选）

当前系统使用内存数据库存储学员和报告信息。在生产环境中，建议：

1. 配置 MySQL/PostgreSQL 数据库
2. 更新 `api_server.py` 中的数据存储逻辑
3. 使用 ORM（如 SQLAlchemy）管理数据
4. 实现数据持久化和备份

详细的数据库 schema 参考 [DEEPSEEK_API_SETUP.md](./DEEPSEEK_API_SETUP.md) 中的"数据库集成"章节。

## 使用示例

### 完整使用流程

1. **教练登录系统**
   - 选择"教练"角色登录

2. **选择训练类型**
   - 进入"训练分析"页面
   - 选择训练类型（投篮/运球/防守）

3. **上传训练视频**
   - 点击"上传视频"
   - 选择视频文件（支持 MP4、AVI、MOV、MKV）
   - 等待上传完成

4. **等待视频分析**
   - 系统自动进行姿态识别
   - 计算训练指标
   - 生成带骨架的输出视频

5. **查看 AI 分析**
   - AI 自动分析训练数据
   - 显示综合评分
   - 查看整体评价

6. **查看详细报告**
   - 点击"查看详细报告"
   - 浏览改进建议
   - 了解优势和改进点

7. **选择学员**
   - 在学员选择下拉框中选择目标学员
   - 可以看到学员的基本信息

8. **发送报告**
   - 点击"发送到家长端"按钮
   - 等待发送完成
   - 查看成功提示

9. **家长查看报告**
   - 家长登录系统
   - 查看收到的训练报告
   - 了解孩子的训练情况和改进建议

## 注意事项

### 1. DeepSeek API

- 需要有效的 API Key 才能使用真实的 AI 分析
- 未配置 API Key 时会使用模拟数据
- 注意 API 调用限额和费用

### 2. 数据存储

- 当前使用内存存储，服务器重启后数据会丢失
- 生产环境务必配置真实数据库
- 定期备份重要数据

### 3. 网络连接

- 确保后端服务器可以访问 DeepSeek API
- 前端需要能够连接到后端 API
- 注意跨域（CORS）配置

### 4. 视频处理

- 视频分析需要一定时间
- 视频质量影响分析准确度
- 建议视频中人物清晰完整

### 5. 性能考虑

- AI 分析需要网络请求，可能需要几秒钟
- 大视频文件上传和处理时间较长
- 建议优化视频大小和分辨率

## 技术支持

如有问题或建议，请联系开发团队。

## 更新日志

### v1.1.0 (2025-10-16)

- ✨ 新增：DeepSeek AI 智能分析功能
- ✨ 新增：学员选择和报告发送功能
- ✨ 新增：训练报告管理系统
- 🔧 优化：三个训练页面的用户体验
- 📝 文档：添加配置和使用指南
- 🧪 测试：添加逻辑验证测试
